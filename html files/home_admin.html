<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Admin</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="../script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div id="taskTable"></div>
<form id="createAccount" action="/home" >
    <h1>Create Account</h1>
    <div>
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstname" required>
    </div>
    <div>
        <label for="lastname">Last Name:</label>
        <input type="text" id="lastname" name="lastname" required>
    </div>
    <div>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
    </div>
    <div>
        <label for="phone_number">Phone Number:</label>
        <input type="tel" id="phone_number" name="phone_number" required>
    </div>
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
    </div>
    <div>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
    </div>
    <div>
        <label for="role">Role:</label>
        <select id="role" name="role">
            <option value="rescuer">Rescuer</option>
            <option value="admin">Admin</option>
        </select>
    </div>
    <div>
        <input type="submit" value="Create Account">
    </div>
    <div id="createAccountMessage"></div>
</form>
<script>
    document.getElementById('createAccount').addEventListener('submit', function(event) {
        event.preventDefault();
        let formData = new URLSearchParams(new FormData(this)).toString();
        fetch('/admin_create_account', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                let messageElement = document.getElementById('message');
                if (data.status === 'success') {
                    messageElement.style.color = 'green';
                } else {
                    messageElement.style.color = 'red';
                }
                messageElement.textContent = data.message;
            })
            .catch(error => console.error('Error:', error));
    });
</script>
<form id="createAnnouncement" action="/home">
    <h1>Create New Announcement</h1>
    <div id="productsContainer">
        <div class="productEntry">
            <label for="selectProduct0">Product:</label>
            <select class="selectProduct" id="selectProduct0" name="selectProduct[]" required></select>
            <label for="quantity0">Quantity:</label>
            <input type="number" class="quantity" id="quantity0" name="quantity[]" required min="1">
        </div>
    </div>
    <button type="button" id="addProductButton">Add Product</button>
    <div>
        <input type="submit" value="Post Announcement">
    </div>
    <div id="createAnnouncementMessage"></div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/products')
            .then(response => response.json())
            .then(data => {
                const selectProductElements = document.querySelectorAll('.selectProduct');
                selectProductElements.forEach(selectProduct => {
                    data.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product._id;
                        option.textContent = product.name;
                        selectProduct.appendChild(option);
                    });
                });
            })
            .catch(error => console.error('Error:', error));
    });

    document.getElementById('addProductButton').addEventListener('click', function() {
        const productsContainer = document.getElementById('productsContainer');
        if (productsContainer.children.length >= 10) {
            alert('You can only add up to 10 products.');
            return;
        }

        const newProductEntry = document.createElement('div');
        newProductEntry.classList.add('productEntry');
        const index = productsContainer.children.length;
        newProductEntry.innerHTML = `
        <label for="selectProduct${index}">Product:</label>
        <select class="selectProduct" id="selectProduct${index}" name="selectProduct[]" required></select>
        <label for="quantity${index}">Quantity:</label>
        <input type="number" class="quantity" id="quantity${index}" name="quantity[]" required min="1">
        <button type="button" class="removeProductButton">Remove</button>
    `;
        productsContainer.appendChild(newProductEntry);

        fetch('/products')
            .then(response => response.json())
            .then(data => {
                const selectProduct = newProductEntry.querySelector('.selectProduct');
                data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product._id;
                    option.textContent = product.name;
                    selectProduct.appendChild(option);
                });
            })
            .catch(error => console.error('Error:', error));
    });

    document.getElementById('productsContainer').addEventListener('click', function(event) {
        if (event.target.classList.contains('removeProductButton')) {
            event.target.parentElement.remove();
        }
    });

    document.getElementById('createAnnouncement').addEventListener('submit', function(event) {
        event.preventDefault();
        let formData = new URLSearchParams(new FormData(this)).toString();
        fetch('/admin_create_announcement', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                let messageElement = document.getElementById('createAnnouncementMessage');
                if (data.status === 'success') {
                    messageElement.style.color = 'green';
                } else {
                    messageElement.style.color = 'red';
                }
                messageElement.textContent = data.message;
            })
            .catch(error => console.error('Error:', error));
    });
</script>

<button id="logoutButton">Logout</button>
    <script>
        document.getElementById('logoutButton').addEventListener('click', function() {
            fetch('/logout', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = data.redirectUrl;
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>